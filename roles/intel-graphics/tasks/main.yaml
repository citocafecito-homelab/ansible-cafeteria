- name: Install Core Deps
  become: true
  ansible.builtin.package:
    name:
      - vainfo
      - intel-media-va-driver
      - intel-media-va-driver-non-free

- name: Verify /dev/dri exists
  stat:
    path: /dev/dri/renderD128
  register: dri_device

- name: Fail if VA-API device is missing
  fail:
    msg: "/dev/dri/renderD128 not found. GPU or driver not available."
  when: not dri_device.stat.exists

- name: Run vainfo to validate VA-API
  command: vainfo
  register: vainfo_output
  changed_when: false
  failed_when: vainfo_output.rc != 0

- name: Show vainfo output
  debug:
    var: vainfo_output.stdout
