- name: Download UV installation script
  ansible.builtin.get_url:
    url: https://astral.sh/uv/install.sh
    dest: /tmp/install_uv.sh
    mode: "0755"
    force: false

- name: Install Universal Virtualenv (UV)
  ansible.builtin.command:
    cmd: /tmp/install_uv.sh
  environment:
    XDG_BIN_HOME: "{{ install_bin_path }}"
  #   PATH: "/usr/local/bin:{{ install_bin_path }}"

- name: Add UV completion to /etc/bash.bashrc (for all users)
  become: true
  ansible.builtin.blockinfile:
    path: /etc/bash.bashrc
    block: |
      # Universal Virtualenv (UV) completion
      eval "$(uv generate-shell-completion bash)"
    marker: "# {mark} ANSIBLE UV COMPLETION BLOCK"

- name: Add UV completion to /etc/profile.d/uv.sh (for all users)
  become: true
  ansible.builtin.copy:
    dest: /etc/profile.d/uv.sh
    content: |
      #!/bin/bash
      eval "$(uv generate-shell-completion bash)"
    mode: '0755'