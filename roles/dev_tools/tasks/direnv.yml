- name: Set Facts
  ansible.builtin.set_fact:
    install_dir: /tmp/install_direnv.sh

- name: Download Direnv installation script
  register: install_result
  ansible.builtin.get_url:
    url: https://direnv.net/install.sh
    dest: "{{ install_dir }}"
    mode: "0755"
    force: false
    
- name: Display Install Result
  debug:
    var: install_result

- name: Install Direnv
  ansible.builtin.command:
    cmd: "{{ install_dir }}"
  environment:
    bin_path: "{{ install_bin_path }}"

- name: Add Direnv completions to /etc/bash.bashrc (for all users)
  become: true
  ansible.builtin.lineinfile:
    path: /etc/bash.bashrc
    line: 'eval "$(direnv hook bash)"'
    state: present
    create: yes

- name: Add Direnv completions to /etc/profile.d/direnv.sh (for all users)
  become: true
  ansible.builtin.copy:
    dest: /etc/profile.d/direnv.sh
    content: |
      #!/bin/bash
      eval "$(direnv hook bash)"
    mode: '0755'

- name: Delete Temporal Install
  ansible.builtin.file:
    path: "{{ install_dir }}"
    state: absent